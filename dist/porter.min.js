/**
 * @package Porter
 * @description An easy way to build real-time apps with a WebSocket server/client and channels.
 * @author chipslays
 * @license MIT
 * @link https://github.com/chipslays/porter
 */
 class Porter{events={};rawEvents={};options={pingInterval:3e4,maxBodySize:1e6};shouldSend=[];connected=null;disconnected=null;error=null;pong;pingInterval;constructor(t,e){this.ws=t,e&&(this.options={...this.options,...e}),this.initPingPongEvent()}initPingPongEvent(){this.pingInterval?clearInterval(this.pingInterval):this.pingInterval=setInterval((()=>{this.sendRaw("ping")}),this.options.pingInterval),this.onRaw("pong",(t=>{"function"==typeof this.pong&&this.pong(t)}))}on(t,e){return this.events[t]=e,this}event(t,e,n){if(n&&this.on(t,n),this.ws.readyState!==WebSocket.OPEN)return this.shouldSend.push({type:t,data:e}),this;let s=JSON.stringify({type:t,data:e||{}});var i=new Blob([s]).size;return i/this.options.maxBodySize>1?(console.warn(`The event was not dispatched because the body size (${i}) exceeded the allowable value (${this.options.maxBodySize}).`),this):(this.ws.send(s),this)}onRaw(t,e){if("pong"==t&&"pong"in this.rawEvents)throw new Error('You cannot override the "pong" service event. Use `porterInstance.pong = () => {...}` instead.');return this.rawEvents[t]=e,this}sendRaw(t){this.ws.send(t)}listen(){this.ws.onopen=()=>{this.shouldSend.forEach((t=>{this.event(t.type,t.data)})),this.connected&&this.connected.call()},this.ws.onclose=this.disconnected,this.ws.onerror=this.error,this.ws.onmessage=t=>{try{var e=JSON.parse(t.data),n=this.events[e.type]||null}catch(s){e=t.data,n=this.rawEvents[t.data]||null}"function"==typeof n&&n(e)}}close(){this.ws.close()}}